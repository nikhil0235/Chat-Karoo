{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/NIKHIL RAJPUT/Desktop/Mern chat app/Chat-Karoo/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _defineProperty from\"C:/Users/NIKHIL RAJPUT/Desktop/Mern chat app/Chat-Karoo/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _asyncToGenerator from\"C:/Users/NIKHIL RAJPUT/Desktop/Mern chat app/Chat-Karoo/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/NIKHIL RAJPUT/Desktop/Mern chat app/Chat-Karoo/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useContext,useState}from'react';import attach from\"../img/attach.png\";import addfile from\"../img/addfile.png\";import{AuthContext}from'../context/AuthContext';import{ChatContext}from'../context/ChatContext';import{arrayUnion,doc,serverTimestamp,Timestamp,updateDoc}from'firebase/firestore';import{db/*storage*/}from'../firebase';import{v4 as uuid}from\"uuid\";//import { getDownloadURL, ref, uploadBytesResumable } from 'firebase/storage'\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Input=function Input(){var _ref;/* We are writing two UseState one is for Text and another is for Image  */var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),text=_useState2[0],setText=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),img=_useState4[0],setImg=_useState4[1];/* we need currentUser*/var _useContext=useContext(AuthContext),currentUser=_useContext.currentUser;//ChatContext is because we are going to need another user \nvar _useContext2=useContext(ChatContext),data=_useContext2.data;var handleSend=function handleSend(){return(_ref=_ref||_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _updateDoc,_updateDoc2;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!img){_context.next=4;break;}console.log(\"This is not working right now \");/*  const storageRef = ref(storage, uuid() );\n\n        const uploadTask = uploadBytesResumable(storageRef, img);\n        \n      \n\n        uploadTask.on(\n          (error) =>{\n\n          },\n\n          () =>{\n                getDownloadURL(uploadTask.snapshot.ref).then(async(downloadURL)=>{\n                  await updateDoc(doc(db,\"chats\",data.chatId),{\n                      \n                    messages :arrayUnion({\n                        id :uuid(),\n                        text,\n                        senderId :currentUser.uid,\n                        data : Timestamp.now(),\n                        img :downloadURL,\n                    }),\n                     \n                  });\n                 \n             });\n                 \n               \n          }\n\n\n\n        );\n       */_context.next=6;break;case 4:_context.next=6;return updateDoc(doc(db,\"chats\",data.chatId),{messages:arrayUnion({id:uuid(),text:text,senderId:currentUser.uid,date:Timestamp.now()/*Not using server TimeStamp instead we are using normal TimeStamp */})});case 6:_context.next=8;return updateDoc(doc(db,\"usersChat\",currentUser.uid),(_updateDoc={},_defineProperty(_updateDoc,data.chatId+\".lastMessage\",{text:text}),_defineProperty(_updateDoc,data.chatId+\".date\",serverTimestamp()),_updateDoc));case 8:_context.next=10;return updateDoc(doc(db,\"usersChat\",data.user.uid),(_updateDoc2={},_defineProperty(_updateDoc2,data.chatId+\".lastMessage\",{text:text}),_defineProperty(_updateDoc2,data.chatId+\".date\",serverTimestamp()),_updateDoc2));case 10:setText(\"\");/*After sending the text and the image we going to delete it  */setImg(null);case 12:case\"end\":return _context.stop();}},_callee);}))).apply(this,arguments);};return/*#__PURE__*/_jsxs(\"div\",{className:\"input\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Type Something.......\",onChange:function onChange(event){return setText(event.target.value);},value:text/*after sending we are removing send text with text normal */}),\" \",/*#__PURE__*/_jsxs(\"div\",{className:\"send\",children:[/*#__PURE__*/_jsx(\"img\",{src:attach,alt:\"\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",style:{display:\"none\"},id:\"file\",onChange:function onChange(event){return setImg(event.target.files[0]);}}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"file\",children:/*#__PURE__*/_jsx(\"img\",{src:addfile,alt:\"\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSend,children:\"Send\"})]})]});};export default Input;","map":{"version":3,"names":["React","useContext","useState","attach","addfile","AuthContext","ChatContext","arrayUnion","doc","serverTimestamp","Timestamp","updateDoc","db","v4","uuid","jsx","_jsx","jsxs","_jsxs","Input","_ref","_useState","_useState2","_slicedToArray","text","setText","_useState3","_useState4","img","setImg","_useContext","currentUser","_useContext2","data","handleSend","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_updateDoc","_updateDoc2","wrap","_callee$","_context","prev","next","console","log","chatId","messages","id","senderId","uid","date","now","_defineProperty","user","stop","apply","arguments","className","children","type","placeholder","onChange","event","target","value","src","alt","style","display","files","htmlFor","onClick"],"sources":["C:/Users/NIKHIL RAJPUT/Desktop/Mern chat app/Chat-Karoo/src/component/Input.jsx"],"sourcesContent":["import React, { useContext, useState } from 'react'\nimport attach from \"../img/attach.png\"\nimport addfile from \"../img/addfile.png\"\nimport { AuthContext } from '../context/AuthContext'\nimport { ChatContext } from '../context/ChatContext'\nimport { arrayUnion, doc, serverTimestamp, Timestamp, updateDoc } from 'firebase/firestore'\nimport { db, /*storage*/ } from '../firebase'\nimport{v4 as uuid} from \"uuid\"\n//import { getDownloadURL, ref, uploadBytesResumable } from 'firebase/storage'\n\n\nconst Input = () => {\n\n\n  /* We are writing two UseState one is for Text and another is for Image  */\n \n    const [text,setText] = useState(\"\");\n    const[img,setImg] = useState(null);\n \n  /* we need currentUser*/\n  const {currentUser}  = useContext(AuthContext)\n\n  //ChatContext is because we are going to need another user \n  const {data}  = useContext(ChatContext)\n\n  \n  const handleSend = async () =>{\n      \n/* Checking if img present or text then we send according to it  */\n\n      if(img){  \n             \n          console.log(\"This is not working right now \")\n      /*  const storageRef = ref(storage, uuid() );\n\n        const uploadTask = uploadBytesResumable(storageRef, img);\n        \n      \n\n        uploadTask.on(\n          (error) =>{\n\n          },\n\n          () =>{\n                getDownloadURL(uploadTask.snapshot.ref).then(async(downloadURL)=>{\n                  await updateDoc(doc(db,\"chats\",data.chatId),{\n                      \n                    messages :arrayUnion({\n                        id :uuid(),\n                        text,\n                        senderId :currentUser.uid,\n                        data : Timestamp.now(),\n                        img :downloadURL,\n                    }),\n                     \n                  });\n                 \n             });\n                 \n               \n          }\n\n\n\n        );\n       */ \n\n      }else{\n           \n        /*using fireBaseFunction arrayUnion to update the Array */\n        await updateDoc(doc(db,\"chats\",data.chatId),\n        {\n              messages : arrayUnion({\n                   \n                 id :uuid(),\n                 text,\n                 senderId:currentUser.uid,\n                 date:Timestamp.now(),\n                 /*Not using server TimeStamp instead we are using normal TimeStamp */\n              })\n        });\n      }\n\n  //We are updating last message and date in users chat which is show in search bar \n  //We need to sort the date hence we see new msg first\n\n      await updateDoc(doc(db,\"usersChat\",currentUser.uid),{\n         [data.chatId + \".lastMessage\"]:{\n            text,\n         },\n\n         [data.chatId+ \".date\"]: serverTimestamp(),\n      });\n\n      /*why two because it for both the users  */\n      await updateDoc(doc(db,\"usersChat\",data.user.uid),{\n        [data.chatId + \".lastMessage\"]:{\n           text,\n        },\n\n        [data.chatId+ \".date\"]: serverTimestamp(),\n     });\n      setText(\"\") /*After sending the text and the image we going to delete it  */\n      setImg(null)\n  };\n\n\n  return (\n    <div className='input'>\n      <input\n       type=\"text\" \n       placeholder='Type Something.......' \n       onChange={event=>setText(event.target.value)}\n\n       value ={text}\n       /*after sending we are removing send text with text normal */\n       /> {/*on Change is basically changing current state of the input */}\n      <div className=\"send\">\n      \n        <img src={attach} alt=\"\" />\n        <input type=\"file\" style ={{display:\"none\"}} id  =\"file\" onChange={event=>setImg(event.target.files[0])}    />\n        <label htmlFor=\"file\">\n          <img src={addfile} alt=\"\" />\n        </label>\n        <button onClick={handleSend} >Send</button>\n      </div>\n    </div>\n  )\n}\n\nexport default Input"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}